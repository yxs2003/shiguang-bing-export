# shiguang-bing-export - 时光Bing站长提交工具


## 项目简介
`shiguang-bing-export` 是一款针对 WordPress 站点开发的 Bing 搜索引擎收录优化全能工具。因官方 Bing 提交工具频繁出现 API 报错问题，我们独立开发了这套解决方案，并整合了市面同类工具缺失的核心功能，旨在帮助站长高效挖掘 Bing 流量潜力——随着 Edge 浏览器预装普及与 Bing 搜索市场占有率提升，其 24 小时内快速收录的优势已成为不可忽视的流量增长点。

本插件从最初的单一链接提取工具，经 10 余个版本连夜迭代，最终形成集**自动提交、网站地图生成、批量链接管理、双提交通道切换**于一体的综合解决方案，彻底解决 Bing 收录过程中的效率与中断问题。

## 核心功能
### 1. 智能自动提交
- 文章/页面更新后自动推送至 Bing 站长平台，无需手动操作
- 核心优势：Bing API 提交额度耗尽时，**自动切换至 IndexNow 提交通道**（支持无限次提交），确保收录流程不中断

### 2. 多维度网站地图生成
- 支持生成总地图索引文件
- 独立生成文章、页面、标签、分类专属网站地图
- 严格遵循 XML 标准，所有 URL 经 `esc_url` 转义处理

### 3. 全站点链接管理
- 一键批量提取网站所有文章/页面链接，支持导出与批量提交
- 支持重复提交历史链接，适配老站优化场景

### 4. 可视化日志与操作面板
- 主面板清晰展示提交日志与报错日志（常见错误已汉化）
- 支持错误链接重新提交，API 额度自动刷新（日志需手动刷新）
- 分 tab 设计：提交日志、链接提交、网站地图生成、API/IndexNow 设置，逻辑清晰

## 插件架构
| 功能模块       | 核心能力                                                                 |
|----------------|--------------------------------------------------------------------------|
| 提交日志面板   | 实时展示提交状态、报错详情，支持错误链接重提交                           |
| 链接提交面板   | 支持 API 提交/IndexNow 提交双模式，集成全站点链接提取功能                 |
| 网站地图面板   | 总地图+分类/文章/页面/标签独立地图生成，支持快速访问与验证               |
| 配置面板       | Bing API 密钥配置、IndexNow 密钥配置、功能开关设置                       |


#### 提交日志面板
[![插件日志](https://s41.ax1x.com/2025/12/02/pZZ3A5n.webp)](https://imgchr.com/i/pZZ3A5n)

#### 链接提交面板
[![链接提交](https://s41.ax1x.com/2025/12/02/pZZ3PbQ.webp)](https://imgchr.com/i/pZZ3PbQ)

#### 网站地图面板
[![网站地图](https://s41.ax1x.com/2025/12/02/pZZ3FEj.webp)](https://imgchr.com/i/pZZ3FEj)

#### 配置面板
[![密钥管理](https://s41.ax1x.com/2025/12/02/pZZ3kUs.webp)](https://imgchr.com/i/pZZ3kUs)

## 更新日志
### v6.1 (2026-01-08)
1. IndexNow 物理文件生成（核心修复）：

- 机制改变：不再依赖 WordPress 的伪静态（Rewrite API），因为 Nginx/Apache 通常会优先处理静态文件，导致伪静态不生效。现在改为在根目录生成真实的 .txt 文件。

- 自动维护：生成新 Key 时自动删除旧文件；插件激活时自动检查并创建文件。

2. 增加卸载清理机制 (uninstall)：

- 新增了 register_uninstall_hook。当你删除插件时，它会自动删除数据库中的日志表 (sgbing_logs) 以及根目录的 IndexNow 验证文件，保持网站整洁。

3. 安全性增强：

- 在处理 AJAX 提交的 URL 时，增加了 esc_url_raw 进行过滤，防止潜在的 XSS 或注入风险。

4. Sitemap 性能微调：

- 优化了 Sitemap 的查询参数，确保只获取必要的数据，减少内存占用。

5. 代码结构优化：

- 将文件写入逻辑封装为私有方法 update_indexnow_file，便于多处复用。


### v5.9 (2025-11-29)
- 新增 `stop_canonical_redirect` 函数，彻底解决 sitemap.xml 后缀自动添加斜杠问题
- 输出 XML 前强制发送 HTTP 200 状态码，避免服务器返回 404 头信息导致爬虫误判
- 优化 SQL 建表语句，将日期默认值 `0000-00-00` 改为支持 NULL/当前时间戳，适配 MySQL Strict Mode
- 增强 XML 转义处理，确保所有 URL 符合 XML 标准规范
- 挂载 `redirect_canonical` 过滤器，禁止 WordPress 对插件生成的 Sitemap 进行重定向

### v5.8 (2025-11-26)
- 优化标签（Tag）网站地图数据获取逻辑，修复获取失败问题
- 新增分类（Category）专属网站地图功能
- 补充功能使用说明：启用前需关闭其他网站地图插件并删除根目录现有 sitemap 文件
- 新增提示：启用网站地图功能后需重新保存伪静态规则以确保正常生成

## 使用须知
1. 启用网站地图功能前，请先禁用其他网站地图类插件，并删除网站根目录下已存在的 sitemap 相关文件
2. 开启网站地图功能后，需进入 WordPress 后台「设置 → 固定链接」，点击「保存更改」（无需修改规则）以刷新伪静态配置
3. 日志数据为实时获取，当日志量较大时可能出现翻页卡顿，建议定期清理历史日志
4. 确保服务器支持 cURL 扩展（用于 API 与 IndexNow 提交），且 PHP 版本 ≥ 7.2


## 反馈与支持
如遇功能问题或需求建议，欢迎通过 GitHub Issues 提交反馈，我们将及时响应处理。

---

**开发理念**：从实际使用痛点出发，用技术解决问题，让每一位站长都能高效利用 Bing 搜索引擎流量潜力。感谢您的选择与支持！
